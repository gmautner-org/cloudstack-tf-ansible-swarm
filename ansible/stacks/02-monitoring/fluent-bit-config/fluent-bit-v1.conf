[SERVICE]
    Parsers_File parsers.conf
    Log_Level    info

[INPUT]
    Name              tail
    Path              /var/lib/docker/containers/*/*-json.log
    Parser            docker
    Tag               docker.*
    Refresh_Interval  5
    DB                /fluent-bit/state/tail.db
    Mem_Buf_Limit     50MB
    Skip_Long_Lines   On
    Skip_Empty_Lines  On

[FILTER]
    Name                parser
    Match               docker.*
    Key_Name            log
    Parser              docker_no_time
    Reserve_Data        On
    Preserve_Key        On

[FILTER]
    Name                modify
    Match               docker.*
    # Add container metadata from the file path
    Add                 container_id ${HOSTNAME}
    # Extract container name from file path if available
    # Remove unnecessary fields to reduce log volume
    Remove              time
    Remove              source

[OUTPUT]
    Name        loki
    Match       docker.*
    Host        loki
    Port        3100
    Uri         /loki/api/v1/push
    Labels      job=fluent-bit,host=${HOSTNAME}
    label_keys  $container_name,$stream
    line_format json
    remove_keys container_id,source
# comment
