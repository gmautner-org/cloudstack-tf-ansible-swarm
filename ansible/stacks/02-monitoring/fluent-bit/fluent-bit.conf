[INPUT]
  Name   tail
  Path   /var/lib/docker/containers/*/*-json.log
  Parser docker
  Tag    docker.*
  DB     /fluent-bit/state/tail.db   # resume after restarts

[FILTER]
  Name       docker
  Match      docker.*
  Merge_Log  On          # flatten JSON logs for easier querying
  Keep_Log   Off         # drop the wrapper after merge
  Labels     On          # get container_name/image + docker labels

[OUTPUT]
  Name   loki
  Match  docker.*
  Url    ${LOKI_URL}
  # Static + safe dynamic labels. Keep it low-cardinality.
  Labels job=fluent-bit,host=${HOSTNAME}
  LabelKeys container_name,stream
  # Optionally trim noisy fields from payload:
  # RemoveKeys container_id,container_image
